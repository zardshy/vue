{"version":3,"sources":["webpack:///./src/assets/images/car.png","webpack:///./src/views/map/ol.vue?393b","webpack:///src/views/map/ol.vue","webpack:///./src/views/map/ol.vue?8c35","webpack:///./src/views/map/ol.vue","webpack:///./src/views/map/ol.vue?fbd5"],"names":["module","exports","__webpack_require__","p","render","_vm","this","_h","$createElement","_c","_self","staticClass","_v","attrs","type","size","icon","plain","on","click","animation","id","staticRenderFns","olvue_type_script_lang_js_","data","requestID","mounted","_this","layer","ol","Tile","source","XYZ","url","vector","Vector","lineAnimateLayer","style","Style","stroke","Stroke","color","width","Zindex","visible","view","View","center","proj","fromLonLat","zoom","total_step","Map","layers","target","logo","lineCoords","newroute","getRoute","units","coords","route","geometry","coordinates","newcoords","total_lineLength","turf_min","per_stepLength","i","length","from","to","lDistance","push","rings","lineMore","concat","distance","splitLength","step","parseInt","leftLength","nlength","pnt","fastLine","Feature","geom","LineString","transform","getSource","addFeature","point","Point","setStyle","image","Icon","src","rotateWithView","origin","clone","counter","animate","first","second","getGeometry","getCoordinates","angle","Math","atan","LineAnimate","setCoordinates","getStyle","getImage","setRotation","requestAnimationFrame","routePath","getVisible","setVisible","line","getFeatures","clear","cancelAnimationFrame","methods","map_olvue_type_script_lang_js_","component","Object","componentNormalizer","__webpack_exports__","_node_modules_mini_css_extract_plugin_dist_loader_js_ref_6_oneOf_1_0_node_modules_css_loader_index_js_ref_6_oneOf_1_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_src_index_js_ref_6_oneOf_1_2_node_modules_cache_loader_dist_cjs_js_ref_0_0_node_modules_vue_loader_lib_index_js_vue_loader_options_ol_vue_vue_type_style_index_0_id_664381f6_scoped_true_lang_css___WEBPACK_IMPORTED_MODULE_0__","_node_modules_mini_css_extract_plugin_dist_loader_js_ref_6_oneOf_1_0_node_modules_css_loader_index_js_ref_6_oneOf_1_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_src_index_js_ref_6_oneOf_1_2_node_modules_cache_loader_dist_cjs_js_ref_0_0_node_modules_vue_loader_lib_index_js_vue_loader_options_ol_vue_vue_type_style_index_0_id_664381f6_scoped_true_lang_css___WEBPACK_IMPORTED_MODULE_0___default","n"],"mappings":"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","file":"js/chunk-b5dc58d8.ce0aff53.js","sourcesContent":["module.exports = __webpack_public_path__ + \"img/car.a5bf12c1.png\";","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"main\"},[_vm._v(\"\\n  移动轨迹显示\\n  \"),_c('el-button',{attrs:{\"type\":\"primary\",\"size\":\"mini\",\"icon\":\"el-icon-loading\",\"plain\":\"\"},on:{\"click\":_vm.animation}},[_vm._v(\"移动\")]),_c('div',{attrs:{\"id\":\"map\"}})],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div class=\"main\">\r\n    移动轨迹显示\r\n    <el-button type=\"primary\" size=\"mini\" icon=\"el-icon-loading\" plain @click=\"animation\">移动</el-button> \r\n\r\n    <div id=\"map\"></div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n\r\n// import 'ol/ol.css';\r\n// import {Map, View} from 'ol';\r\n// import TileLayer from 'ol/layer/Tile';\r\n// import OSM from 'ol/source/OSM';\r\nimport * as turf from '@turf/turf'\r\n\r\nexport default {\r\n  data(){\r\n    return{\r\n      requestID:null\r\n    }\r\n  },\r\n  mounted(){\r\n     var layer = new ol.layer.Tile({\r\n            source: new ol.source.XYZ({\r\n                url: 'http://www.google.cn/maps/vt?pb=!1m5!1m4!1i{z}!2i{x}!3i{y}!4i256!2m3!1e0!2sm!3i342009817!3m9!2szh-CN!3sCN!5e18!12m1!1e47!12m3!1e37!2m1!1ssmartmaps!4e0&token=32965'\r\n            })\r\n        });\r\n        var vector = new ol.layer.Vector({\r\n            source: new ol.source.Vector()\r\n        });\r\n\r\n        var lineAnimateLayer = new ol.layer.Vector({\r\n            source: new ol.source.Vector(),\r\n            style: new ol.style.Style({\r\n                stroke: new ol.style.Stroke({\r\n                    color: '#ec0404',\r\n                    width: 1\r\n                })\r\n            }),\r\n            Zindex: 999,\r\n            visible: false\r\n        });\r\n\r\n        var view = new ol.View({\r\n            center: new ol.proj.fromLonLat([114.60, 30.65]),\r\n            zoom: 13\r\n        });\r\n        var map = new ol.Map({\r\n            layers: [layer, vector, lineAnimateLayer],\r\n            view: view,\r\n            target: \"map\",\r\n            logo: false\r\n        })\r\n\r\n\r\n        var total_step = 1000;\r\n        var lineCoords = [[114.56, 30.66], [114.66, 30.66], [114.66, 30.63], [114.67, 30.63], [114.67, 30.65], [114.62, 30.63], [114.61, 30.64]];\r\n        var newroute = getRoute(lineCoords, total_step, { units: 'kilometers' })\r\n\r\n        function getRoute(coords, total_step, units) {\r\n            var route = {\r\n                \"type\": \"Feature\",\r\n                \"geometry\": {\r\n                    \"type\": \"LineString\",\r\n                    \"coordinates\": coords\r\n                }\r\n            }\r\n            var newcoords = [];\r\n            var total_lineLength = turf.lineDistance(route);\r\n            var per_stepLength = total_lineLength / total_step;\r\n            // console.log(total_step, per_stepLength)\r\n            for (let i = 0; i < coords.length - 1; i++) {\r\n                var from = turf.point(coords[i]);\r\n                var to = turf.point(coords[i + 1]);\r\n                let lDistance = turf.distance(from, to, units);\r\n                if (i == 0) {\r\n                    newcoords.push(coords[0])\r\n                }\r\n                if (lDistance > per_stepLength) {\r\n                    let rings = lineMore(from, to, lDistance, per_stepLength, units)\r\n                    newcoords = newcoords.concat(rings)\r\n                } else {\r\n                    newcoords.push(coords[i + 1])\r\n                }\r\n            }\r\n            return newcoords\r\n        }\r\n\r\n        function lineMore(from, to, distance, splitLength, units) {\r\n            var step = parseInt(distance / splitLength)\r\n            var leftLength = distance - step * splitLength\r\n            var rings = []\r\n            var route = turf.lineString([from.geometry.coordinates, to.geometry.coordinates])\r\n            for (let i = 1; i <= step; i++) {\r\n                let nlength = i * splitLength\r\n                let pnt = turf.along(route, nlength, { units: 'kilometers' });\r\n                rings.push(pnt.geometry.coordinates)\r\n            }\r\n            if (leftLength > 0) {\r\n                rings.push(to.geometry.coordinates)\r\n            }\r\n            return rings\r\n        }\r\n\r\n\r\n        var fastLine = new ol.Feature({\r\n            geometry: new ol.geom.LineString(newroute).transform('EPSG:4326', 'EPSG:3857')\r\n        });\r\n        vector.getSource().addFeature(fastLine);\r\n\r\n        //lineAnimateLayer.getSource().addFeature(fastLine.clone());\r\n\r\n        var point = new ol.Feature({\r\n            geometry: new ol.geom.Point(new ol.proj.fromLonLat([114.56, 30.66])),\r\n        });\r\n        point.setStyle(new ol.style.Style({\r\n            image: new ol.style.Icon({\r\n                src: require('@/assets/images/car.png'),\r\n                rotateWithView: true,\r\n            })\r\n        }));\r\n        var origin = point.clone();\r\n        vector.getSource().addFeature(point);\r\n\r\n  \r\n        var counter = 0;\r\n\r\n        // function animate() {\r\n        //     counter++;\r\n        //     if (counter < total_step) {\r\n        //         var second = fastLine.getGeometry().getCoordinates()[counter];\r\n        //         var first\r\n        //         if (counter === 1) {\r\n        //             first = origin.getGeometry().getCoordinates();\r\n        //         } else {\r\n        //             first = point.getGeometry().getCoordinates();\r\n        //         }\r\n        //         var angle = -Math.atan((second[1] - first[1]) / (second[0] - first[0]));\r\n        //         LineAnimate(second, angle);\r\n        //         point.getGeometry().setCoordinates(fastLine.getGeometry().getCoordinates()[counter]);\r\n        //         point.getStyle().getImage().setRotation(angle);\r\n        //         this.requestID = requestAnimationFrame(animate);\r\n        //     }\r\n        // }\r\n\r\n        const animate=()=>{\r\n                      counter++;\r\n            if (counter < total_step) {\r\n                var second = fastLine.getGeometry().getCoordinates()[counter];\r\n                var first\r\n                if (counter === 1) {\r\n                    first = origin.getGeometry().getCoordinates();\r\n                } else {\r\n                    first = point.getGeometry().getCoordinates();\r\n                }\r\n                var angle = -Math.atan((second[1] - first[1]) / (second[0] - first[0]));\r\n                LineAnimate(second, angle);\r\n                point.getGeometry().setCoordinates(fastLine.getGeometry().getCoordinates()[counter]);\r\n                point.getStyle().getImage().setRotation(angle);\r\n                this.requestID = requestAnimationFrame(animate);\r\n            }\r\n        }\r\n\r\n        var routePath = [];\r\n\r\n        function LineAnimate(second, angle) {\r\n            // console.log(angle);\r\n            if (!lineAnimateLayer.getVisible()) {\r\n                lineAnimateLayer.setVisible(true)\r\n            }\r\n            if (counter === 1) {\r\n                routePath.push(origin.getGeometry().getCoordinates(), second);\r\n                var line = new ol.Feature({\r\n                    geometry: new ol.geom.LineString(routePath)\r\n                });\r\n                lineAnimateLayer.getSource().addFeature(line);\r\n            } else {\r\n                routePath.push(second);\r\n            }\r\n            lineAnimateLayer.getSource().getFeatures()[0].getGeometry().setCoordinates(routePath);\r\n        };\r\n\r\n        routePath = [];\r\n        counter = 0;\r\n        lineAnimateLayer.getSource().clear();\r\n        if (this.requestID) {\r\n            cancelAnimationFrame(this.requestID);\r\n        }\r\n        animate();\r\n\r\n  },\r\n  methods:{\r\n\r\n    animation(){\r\n        routePath = [];\r\n        counter = 0;\r\n        lineAnimateLayer.getSource().clear();\r\n        if (this.requestID) {\r\n            cancelAnimationFrame(this.requestID);\r\n        }\r\n        animate();\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n\r\n<style scoped>\r\n.main {\r\n  background-color: #ffffff;\r\n  padding: 10px;\r\n}\r\n#map {\r\n  height: calc(100vh - 120px);\r\n  margin: 0px;\r\n  padding: 0px;\r\n}\r\n</style>","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ol.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ol.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./ol.vue?vue&type=template&id=664381f6&scoped=true&\"\nimport script from \"./ol.vue?vue&type=script&lang=js&\"\nexport * from \"./ol.vue?vue&type=script&lang=js&\"\nimport style0 from \"./ol.vue?vue&type=style&index=0&id=664381f6&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"664381f6\",\n  null\n  \n)\n\nexport default component.exports","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ol.vue?vue&type=style&index=0&id=664381f6&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ol.vue?vue&type=style&index=0&id=664381f6&scoped=true&lang=css&\""],"sourceRoot":""}